# File: azure-pipelines.yml
trigger:
- main
pool:
  vmImage: 'windows-latest'
variables:
  USER_SERVER: $(SQLserver)
  USER_DB: $(DB)
  USER_ID: $(DBLogin)
  USER_PASS: $(DBPW)
stages:
- stage: PublishToAzureSQL
  jobs:
  - job: PublishToAzureSQLDevelopment
    steps:
    - checkout: none
    
    - task: AzurePowerShell@5
      displayName: 'Run SQL queries'
      inputs:
        azureSubscription: 'Connect Azure SQL DB with Azure DevOps' 
        ScriptType: InlineScript
        Inline: |
          $SQLserver = $(USER_SERVER)
          $DB = $(USER_DB)
          $Login = $(USER_ID)
          $PW = $(USER_PASS)
          $result = Invoke-sqlcmd -ConnectionString "Data Source=$SQLserver;Initial Catalog=$DB;User Id=$Login;Password=$PW" -Query "select * from dbo.characters"
          Write-Host $result
        azurePowerShellVersion: LatestVersion